<!doctype html>
<html lang="en">

<%- include('./layouts/header') %>

<body class="bg-light">
  <%- include('./layouts/navber') %>

  <div class="container py-5">
    <div class="card shadow-lg rounded-4 border-0">
      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center rounded-top-4">
        <h5 class="mb-0">ðŸ’¬ Your Chats</h5>
      </div>
      <div class="list-group list-group-flush">
        <% chats.forEach(chat => { %>
          <a href="<%= user.role === 'client' ? '/client/chat/' : '/chat/' %><%= chat.otherUser._id %>/<%= chat.lastMessage.jobId %>" 
             class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-3 border-0 border-bottom"
             style="transition: all 0.2s ease-in-out;">
            
            <!-- Left side: avatar + name + last message -->
            <div class="d-flex align-items-center">
              <!-- Avatar -->
              <div class="rounded-circle bg-gradient d-flex align-items-center justify-content-center me-3 text-white shadow-sm"
                   style="width: 50px; height: 50px; background: linear-gradient(135deg, #0d6efd, #6610f2); font-weight: bold; font-size: 1.2rem; margin-right: 15px;">
                <%= chat.otherUser.name.charAt(0).toUpperCase() %>
              </div>

              <!-- Name + Last message -->
              <div>
                <h6 class="mb-1 fw-bold"><%= chat.otherUser.name %></h6>
                <small class="text-muted d-block" style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                  <%= chat.lastMessage.message %>
                </small>
              </div>
            </div>

            <!-- Right side: timestamp + unread -->
            <div class="text-end">
              <small class="text-muted d-block mb-1">
                <%= new Date(chat.lastMessage.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) %>
              </small>

              <% if (!chat.lastMessage.status || chat.lastMessage.status !== 'seen') { %>
                <span class="badge rounded-pill bg-success shadow-sm">New</span>
              <% } %>
            </div>
          </a>
        <% }) %>
      </div>
    </div>
  </div>

  <%- include('./layouts/footer') %>
</body>
</html>
